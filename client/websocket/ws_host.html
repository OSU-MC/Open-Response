<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>WebSocket Host</title>
</head>

<body>
	<h1>WebSocket Host</h1>
	<button id="addClient">Add Client</button>
	<h2>Connected Clients</h2>
	<ul id="clients">
	<li>No clients connected</li>
	</ul>

	<script>
		const socket = new WebSocket('ws://localhost:8080');
		const clientsList = document.getElementById('clients');
		const addClientButton = document.getElementById('addClient');

		const clientWindows = new Map();

		// Console message for successful host startup
		socket.addEventListener('open', () => {
			console.log('Host connected to WebSocket server');
		});

		// If client data recieved in message, display data to new element
		socket.addEventListener('message', (event) => {
			try {
				const data = JSON.parse(event.data);

				if (data.clients) {
					clientsList.innerHTML = '';
					data.clients.forEach(clientId => {
						const li = document.createElement('li');
						li.textContent = `Client ID: ${clientId}`;

						clientsList.appendChild(li);
					});
				}
			} catch (error) {
				console.error('Error parsing message:', error);
			}
		});

		// Display disconnected message
		socket.addEventListener('close', () => {
			console.log('Disconnected from WebSocket server');
			clientsList.innerHTML = '<li>Disconnected</li>';
		});

		// Display error
		socket.addEventListener('error', (error) => {
			console.error('WebSocket error:', error);
		});

		// If add client button is clicked, open a new client window and automatically connect
		addClientButton.addEventListener('click', () => {
			const newClientWindow = window.open('ws_client.html', '_blank');
			if (!newClientWindow) {
				alert('Please allow pop-ups to add a new client.');
				return;
			}
		});
	</script>
</body>
</html>
